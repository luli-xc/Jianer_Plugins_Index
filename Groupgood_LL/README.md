# Groupgood - QQ群精华消息管理插件

## 📖 项目概述

**Groupgood** 是一个基于 [Hyper] 框架开发的 QQ 群精华消息管理插件。该插件允许群管理员通过简单的命令快速设置或删除群聊中的精华消息，无需进入 QQ 客户端操作，大大提升群管理效率。

## ✨ 功能特性

| 功能 | 描述 |
|------|------|
| 🌟 **设置精华** | 快速将指定消息设为群精华 |
| 🗑️ **删除精华** | 快速移除已设置的群精华消息 |
| 📋 **白名单机制** | 支持白名单模式，限制可使用的群聊 |
| ⚡ **异步处理** | 基于 `asyncio` 实现，响应快速 |
| 🔌 **WebSocket 通信** | 实时与 OneBot 协议服务端通信 |
| 💬 **友好提示** | 提供详细的操作反馈和错误提示 |


### 环境要求

- 已安装 Hyper 框架及相关依赖
- OneBot 协议支持的 QQ 机器人服务端（napcat）


### 插件部署

1. 将 `Groupgood.py` 文件复制到您的 plugins 插件目录中
2. 确保 `config.json` 配置文件已正确设置，包含 `reminder` 字段
3. 根据您的服务端配置，检查 WebSocket 连接地址


### 基本命令

| 命令 | 功能说明 |
|------|----------|
| `{reminder}设置精华` 或 `{reminder}设为精华` | 将回复的目标消息设为精华 |
| `{reminder}删除精华` 或 `{reminder}移除精华` | 将回复的目标消息从精华中移除 |

> **注意**：`{reminder}` 是您在 `config.json` 中配置的前缀（如 `#`、`!` 等）

### 操作流程

1. **回复目标消息**：在群聊中找到想要设为精华的消息，长按/右键选择"回复"
2. **发送命令**：在回复框中输入精华管理命令（如 `#设置精华`）
3. **查看结果**：机器人将反馈操作结果

### 帮助信息

发送 `{reminder}帮助` 或直接查看代码中的 `HELP_MESSAGE`，可获取命令说明。

## ⚙️ 参数说明

### 配置文件

插件依赖 `config.json` 文件，需要包含以下配置，基本不用动：

```json
{
    "connection": {
        "host": "127.0.0.1",
        "port": 5004
    },
    "others": {
        "reminder": "#"
    }
}
```

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `connection.host` | string | `127.0.0.1` | OneBot 服务端主机地址 |
| `connection.port` | int | `5004` | OneBot 服务端 WebSocket 端口 |
| `others.reminder` | string | `#` | 命令触发前缀 |

### 插件内配置

| 常量 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `WHITE_LIST_ENABLED` | bool | `False` | 是否启用白名单模式 |
| `WHITE_LIST` | list | `["114514", "350234"]` | 允许使用功能的群号列表 |

### 白名单配置

编辑 `Groupgood.py` 文件中的以下配置：

```python
# 白名单开关：True=启用白名单，False=禁用白名单（所有群都可以使用）
WHITE_LIST_ENABLED = False
WHITE_LIST = ["114514", "350234"]  # 允许的群号列表
```

- 当 `WHITE_LIST_ENABLED = True` 时，只有白名单中的群号可以使用精华功能
- 当 `WHITE_LIST_ENABLED = False` 时，所有群聊都可以使用该功能


### 设置精华消息

```
[用户A] 这是一条重要消息！

[管理员] （回复上述消息）#设置精华
[机器人] ✅ 已将此消息设为精华啦
```

### 删除精华消息

```
[用户A] 这是一条重要消息！

[管理员] （回复上述消息）#删除精华
[机器人] ✅ 已删除此消息的精华状态
```

### 错误示例

```
[管理员] #设置精华  （没有回复任何消息）
[机器人] ⚠️ 请回复一条消息后发送'#设为精华/设置精华'命令
```

## ⚠️ 注意事项

1. **权限要求**：只有群管理员或群主才能设置/删除精华消息，若机器人是普通群成员执行操作会收到失败提示
2. **回复要求**：命令必须通过"回复"消息的方式发送，直接发送命令无效
3. **网络依赖**：插件需要与 OneBot 服务端保持 WebSocket 连接，断网或服务端离线会导致功能不可用
4. **超时处理**：服务端响应超时时间为 5 秒，超时后将提示失败
5. **群聊限制**：私聊消息不会触发该插件功能
6. **并发处理**：插件使用异步处理，支持同时处理多个群的请求

## ❓ 常见问题解答

### Q1: 为什么发送命令后没有反应？

**可能原因：**
- 命令前缀不正确，请检查 `config.json` 中的 `reminder` 配置
- 未以"回复"方式发送命令
- 机器人服务端未启动或 WebSocket 连接失败

**解决方法：**
- 确认命令前缀，如 `#设置精华`
- 长按/右键目标消息选择"回复"后再发送命令
- 检查 OneBot 服务端是否正常运行

### Q2: 提示"设置精华失败"怎么办？

**可能原因：**
- 机器人不是群管理员/群主
- 目标消息已经是精华消息（重复设置）
- 服务端 API 调用失败

**解决方法：**
- 确认机器人是群管理员/群主
- 检查消息是否已经是精华
- 查看机器人控制台日志获取详细错误信息

### Q3: 如何限制只有特定群可以使用？

**解决方法：**
编辑 `Groupgood.py`，修改以下配置：
```python
WHITE_LIST_ENABLED = True
WHITE_LIST = ["你的群号1", "你的群号2"]
```

### Q4: WebSocket 连接失败怎么办？

**解决方法：**
- 检查 `config.json` 中的 `host` 和 `port` 配置是否与 OneBot 服务端一致
- 确认服务端已开启 WebSocket 反向/正向连接
- 检查防火墙设置是否允许连接

### Q5: 如何修改命令触发词？

**解决方法：**
编辑 `Groupgood.py` 中的命令检测逻辑：
```python
is_set = f"{reminder_prefix}设为精华" in msg_str or f"{reminder_prefix}设置精华" in msg_str
is_delete = f"{reminder_prefix}删除精华" in msg_str or f"{reminder_prefix}移除精华" in msg_str
```


## 👤 作者信息

- **作者**：陆离
- **邮箱**：lulixc2025@163.com

## 🙏 致谢

- [Hyper](https://github.com/HyperBots) - 优秀的 Python QQ 机器人框架
- [OneBot](https://github.com/botuniverse/onebot-11) - 简洁的聊天机器人应用接口标准

---


